<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n l√Ω s·∫£n ph·∫©m h·ªçc vi√™n</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://apis.google.com/js/api.js"></script>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üéì Qu·∫£n l√Ω s·∫£n ph·∫©m h·ªçc vi√™n</h1>
            <div class="nav">
                <button class="nav-btn active" onclick="showHome()">üè† Trang ch·ªß</button>
                <button class="nav-btn" onclick="showAllStudents()">üë• T·∫•t c·∫£ h·ªçc vi√™n</button>
                <button class="nav-btn" onclick="showSearchPage()">üîç T√¨m ki·∫øm</button>
                <button class="nav-btn admin-only" onclick="showAddClassModal()">‚ûï Th√™m l·ªõp</button>
                <button class="nav-btn" onclick="exportData()">üìä Xu·∫•t Excel</button>
                <button class="nav-btn admin-only" onclick="showImportModal()">üìÅ Nh·∫≠p Excel</button>
                <button class="nav-btn admin-only" onclick="manualSaveData()">üíæ L∆∞u d·ªØ li·ªáu</button>
                <button class="nav-btn" id="login-btn" onclick="showLoginModal()">üîê ƒêƒÉng nh·∫≠p</button>
                <button class="nav-btn hidden" id="logout-btn" onclick="logout()">üö™ ƒêƒÉng xu·∫•t</button>
            </div>
        </div>

        <div class="content">
            <!-- Trang ch·ªß -->
            <div id="home-page">
                <div class="actions" style="margin-bottom: 20px;">
                    <button class="btn admin-only" onclick="showAddClassModal()">‚ûï Th√™m l·ªõp h·ªçc m·ªõi</button>
                    <button class="btn btn-secondary" onclick="showFormatGuide()">üìã H∆∞·ªõng d·∫´n Excel</button>
                    <button class="btn btn-danger admin-only" onclick="clearAllData()">üóëÔ∏è X√≥a t·∫•t c·∫£ d·ªØ li·ªáu</button>
                </div>
                <h2>C√°c l·ªõp h·ªçc ƒëang gi·∫£ng d·∫°y</h2>
                <div id="class-grid"></div>
            </div>

            <!-- Trang t√¨m ki·∫øm -->
            <div id="search-page" class="hidden">
                <h2>üîç T√¨m ki·∫øm h·ªçc vi√™n</h2>
                <div class="search-container">
                    <div class="search-box">
                        <input type="text" id="search-input"
                            placeholder="Nh·∫≠p t√™n h·ªçc vi√™n, email ho·∫∑c th√¥ng tin c·∫ßn t√¨m..." oninput="performSearch()">
                        <span class="search-icon">üîç</span>
                    </div>
                    <div class="search-filters">
                        <div class="filter-item">
                            <label style="color: #333; font-weight: bold;">L·ªçc theo l·ªõp:</label>
                            <select id="search-class-filter" class="filter-select" onchange="performSearch()">
                                <option value="">T·∫•t c·∫£ l·ªõp</option>
                            </select>
                        </div>
                        <div class="filter-item">
                            <label style="color: #333; font-weight: bold;">S·∫£n ph·∫©m:</label>
                            <select id="search-product-filter" class="filter-select" onchange="performSearch()">
                                <option value="">T·∫•t c·∫£</option>
                                <option value="with-products">C√≥ s·∫£n ph·∫©m</option>
                                <option value="no-products">Ch∆∞a c√≥ s·∫£n ph·∫©m</option>
                            </select>
                        </div>
                        <button class="clear-filters-btn" onclick="clearSearchFilters()">X√≥a b·ªô l·ªçc</button>
                    </div>
                    <div class="search-stats" id="search-stats"></div>
                </div>
                <div id="search-results" class="student-list"></div>
            </div>

            <!-- Trang l·ªõp h·ªçc -->
            <div id="class-page" class="hidden">
                <button class="btn back-btn" onclick="showHome()">‚Üê Quay l·∫°i</button>
                <div class="actions">
                    <button class="btn admin-only" onclick="showAddStudentForm()">‚ûï Th√™m h·ªçc vi√™n</button>
                    <button class="btn btn-secondary" onclick="exportClassData()">üìä Xu·∫•t d·ªØ li·ªáu l·ªõp</button>
                    <button class="btn admin-only" onclick="showImportModal()">üìÅ Nh·∫≠p Excel l·ªõp</button>
                    <button class="btn" onclick="showClassFeedback()">üìã Nh·∫≠n x√©t l·ªõp</button>
                </div>
                <h2 id="class-title"></h2>
                <div id="class-comment-section">
                    <h3>Nh·∫≠n x√©t l·ªõp</h3>
                    <textarea id="class-comment" class="comment-box"></textarea>
                    <button class="btn admin-only" onclick="saveClassComment()">L∆∞u nh·∫≠n x√©t</button>
                </div>
                <div id="students-list" class="student-list"></div>
            </div>

            <!-- Trang s·∫£n ph·∫©m h·ªçc vi√™n -->
            <div id="student-page" class="hidden">
                <button class="btn back-btn" onclick="goBackToClass()">‚Üê Quay l·∫°i l·ªõp</button>
                <div class="actions">
                    <button class="btn admin-only" onclick="showAddProductForm()">‚ûï Th√™m s·∫£n ph·∫©m</button>
                    <button class="btn" onclick="showFeedbackHistory()">üìã Xem nh·∫≠n x√©t</button>
                    <button class="btn btn-secondary" onclick="exportStudentData()">üìä Xu·∫•t d·ªØ li·ªáu h·ªçc vi√™n</button>
                </div>
                <h2 id="student-title"></h2>
                <div id="products-container">
                    <table class="product-table" id="products-table">
                        <thead>
                            <tr>
                                <th>Bu·ªïi h·ªçc</th>
                                <th>T√™n s·∫£n ph·∫©m</th>
                                <th>√ù t∆∞·ªüng</th>
                                <th>Nhi·ªám v·ª• bu·ªïi h·ªçc</th>
                                <th>Nhi·ªám v·ª• v·ªÅ nh√†</th>
                                <th>Ti·∫øn ƒë·ªô</th>
                                <th>G√≥p √Ω</th>
                                <th>Thao t√°c</th>
                            </tr>
                        </thead>
                        <tbody id="products-tbody"></tbody>
                    </table>
                </div>
            </div>

            <!-- Trang t·∫•t c·∫£ h·ªçc vi√™n -->
            <div id="all-students-page" class="hidden">
                <button class="btn back-btn" onclick="showHome()">‚Üê Quay l·∫°i</button>
                <h2>T·∫•t c·∫£ h·ªçc vi√™n</h2>
                <div id="all-students-list" class="student-list"></div>
            </div>
        </div>
    </div>

    <!-- Modal th√™m l·ªõp h·ªçc -->
    <div id="add-class-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('add-class-modal')">&times;</span>
            <h3>Th√™m l·ªõp h·ªçc m·ªõi</h3>
            <div class="form-container">
                <div class="form-group">
                    <label for="class-code">M√£ l·ªõp:</label>
                    <input type="text" id="class-code" placeholder="V√≠ d·ª•: PTI06, JSB06" required>
                </div>
                <div class="form-group">
                    <label for="class-name">T√™n l·ªõp:</label>
                    <input type="text" id="class-name" placeholder="V√≠ d·ª•: L·∫≠p tr√¨nh Python n√¢ng cao" required>
                </div>
                <div class="form-group">
                    <label for="class-type">Lo·∫°i l·ªõp:</label>
                    <select id="class-type">
                        <option value="coding">Coding</option>
                        <option value="robotic">Robotic</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="class-description">M√¥ t·∫£:</label>
                    <textarea id="class-description" placeholder="M√¥ t·∫£ ng·∫Øn v·ªÅ l·ªõp h·ªçc"></textarea>
                </div>
                <button class="btn" onclick="addClass()">Th√™m l·ªõp</button>
            </div>
        </div>
    </div>

    <!-- Modal th√™m h·ªçc vi√™n -->
    <div id="add-student-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('add-student-modal')">&times;</span>
            <h3>Th√™m h·ªçc vi√™n m·ªõi</h3>
            <div class="form-container">
                <div class="form-group">
                    <label for="student-name">T√™n h·ªçc vi√™n:</label>
                    <input type="text" id="student-name" required>
                </div>
                <div class="form-group">
                    <label for="student-email">Email:</label>
                    <input type="email" id="student-email">
                </div>
                <div class="form-group">
                    <label for="student-phone">S·ªë ƒëi·ªán tho·∫°i:</label>
                    <input type="tel" id="student-phone">
                </div>
                <button class="btn" onclick="addStudent()">Th√™m h·ªçc vi√™n</button>
            </div>
        </div>
    </div>

    <!-- Modal th√™m/s·ª≠a s·∫£n ph·∫©m -->
    <div id="add-product-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('add-product-modal')">&times;</span>
            <h3 id="product-modal-title">Th√™m s·∫£n ph·∫©m m·ªõi</h3>
            <div class="form-container">
                <div class="form-group">
                    <label for="product-session">Bu·ªïi h·ªçc:</label>
                    <input type="number" id="product-session" min="1" required>
                </div>
                <div class="form-group">
                    <label for="product-name">T√™n s·∫£n ph·∫©m:</label>
                    <input type="text" id="product-name" required>
                </div>
                <div class="form-group">
                    <label for="product-idea">√ù t∆∞·ªüng:</label>
                    <textarea id="product-idea"></textarea>
                </div>
                <div class="form-group">
                    <label for="product-class-task">Nhi·ªám v·ª• bu·ªïi h·ªçc:</label>
                    <textarea id="product-class-task"></textarea>
                </div>
                <div class="form-group">
                    <label for="product-homework">Nhi·ªám v·ª• v·ªÅ nh√†:</label>
                    <textarea id="product-homework"></textarea>
                </div>
                <div class="form-group">
                    <label for="product-progress">Ti·∫øn ƒë·ªô ho√†n th√†nh (%):</label>
                    <input type="number" id="product-progress" min="0" max="100" value="0">
                </div>
                <div id="feedback-fields"></div>
                <button class="btn" onclick="saveProduct()" id="save-product-btn">Th√™m s·∫£n ph·∫©m</button>
            </div>
        </div>
    </div>
    
    <!-- Modal xem chi ti·∫øt -->
    <div id="detail-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeDetail()">&times;</span>
            <h3>Chi ti·∫øt n·ªôi dung</h3>
            <div id="detail-content" style="white-space: pre-wrap;"></div>
        </div>
    </div>

    <!-- Modal l·ªãch s·ª≠ nh·∫≠n x√©t -->
    <div id="feedback-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('feedback-modal')">&times;</span>
            <h3>Nh·∫≠n x√©t c√°c bu·ªïi h·ªçc</h3>
            <div id="feedback-history"></div>
        </div>
    </div>

    <!-- Modal nh·∫≠n x√©t l·ªõp -->
    <div id="class-feedback-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('class-feedback-modal')">&times;</span>
            <h3>Nh·∫≠n x√©t l·ªõp</h3>
            <table class="product-table">
                <thead>
                    <tr>
                        <th>H·ªçc vi√™n</th>
                        <th>Bu·ªïi</th>
                        <th>Nh·∫≠n x√©t</th>
                        <th>Thao t√°c</th>
                    </tr>
                </thead>
                <tbody id="class-feedback-body"></tbody>
            </table>
        </div>
    </div>

    <!-- Modal nh·∫≠p Excel -->
    <div id="import-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('import-modal')">&times;</span>
            <h3>Nh·∫≠p d·ªØ li·ªáu t·ª´ Excel</h3>
            <div class="form-container">
                <div class="form-group">
                    <label for="excel-file">Ch·ªçn file Excel:</label>
                    <input type="file" id="excel-file" accept=".xlsx,.xls" onchange="handleFileUpload(event)">
                </div>
                <div class="form-group">
                    <label for="import-class">Ch·ªçn l·ªõp ƒë·ªÉ nh·∫≠p:</label>
                    <select id="import-class"></select>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="overwrite-data"> Ghi ƒë√® d·ªØ li·ªáu c≈©
                    </label>
                    <small style="color: #666; display: block; margin-top: 5px;">
                        N·∫øu kh√¥ng ch·ªçn, d·ªØ li·ªáu m·ªõi s·∫Ω ƒë∆∞·ª£c th√™m v√†o d·ªØ li·ªáu hi·ªán c√≥
                    </small>
                </div>
                <div id="preview-container" style="margin-top: 20px; max-height: 300px; overflow-y: auto;"></div>
                <button class="btn" onclick="importData()" id="import-btn" disabled>Nh·∫≠p d·ªØ li·ªáu</button>
            </div>
        </div>
    </div>

    <!-- Modal h∆∞·ªõng d·∫´n format Excel -->
    <div id="format-guide-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('format-guide-modal')">&times;</span>
            <h3>H∆∞·ªõng d·∫´n ƒë·ªãnh d·∫°ng file Excel</h3>
            <div style="text-align: left;">
                <h4>ƒê·ªãnh d·∫°ng c·ªôt trong Excel:</h4>
                <table class="product-table" style="margin: 15px 0;">
                    <thead>
                        <tr>
                            <th>A</th>
                            <th>B</th>
                            <th>C</th>
                            <th>D</th>
                            <th>E</th>
                            <th>F</th>
                            <th>G</th>
                            <th>H</th>
                            <th>I</th>
                            <th>J</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>T√™n h·ªçc vi√™n</td>
                            <td>Email</td>
                            <td>S·ªë ƒëi·ªán tho·∫°i</td>
                            <td>Bu·ªïi h·ªçc</td>
                            <td>T√™n s·∫£n ph·∫©m</td>
                            <td>√ù t∆∞·ªüng</td>
                            <td>Nhi·ªám v·ª• bu·ªïi h·ªçc</td>
                            <td>Nhi·ªám v·ª• v·ªÅ nh√†</td>
                            <td>Ti·∫øn ƒë·ªô (%)</td>
                            <td>G√≥p √Ω</td>
                        </tr>
                        <tr>
                            <td>Nguy·ªÖn VƒÉn A</td>
                            <td>email@test.com</td>
                            <td>0123456789</td>
                            <td>1</td>
                            <td>Calculator App</td>
                            <td>·ª®ng d·ª•ng t√≠nh to√°n</td>
                            <td>H·ªçc Python c∆° b·∫£n</td>
                            <td>Ho√†n th√†nh giao di·ªán</td>
                            <td>75</td>
                            <td>L√†m t·ªët</td>
                        </tr>
                    </tbody>
                </table>
                <div style="background: #f0f8ff; padding: 15px; border-radius: 10px; margin: 15px 0;">
                    <h4 style="color: #0066cc; margin-bottom: 10px;">üìù L∆∞u √Ω quan tr·ªçng:</h4>
                    <ul style="margin-left: 20px; color: #333;">
                        <li>D√≤ng ƒë·∫ßu ti√™n ph·∫£i l√† ti√™u ƒë·ªÅ c·ªôt (header)</li>
                        <li>N·∫øu h·ªçc vi√™n kh√¥ng c√≥ s·∫£n ph·∫©m, ƒë·ªÉ tr·ªëng c√°c c·ªôt t·ª´ D ƒë·∫øn J</li>
                        <li>M·ªôt h·ªçc vi√™n c√≥ th·ªÉ c√≥ nhi·ªÅu s·∫£n ph·∫©m (nhi·ªÅu d√≤ng)</li>
                        <li>Ti·∫øn ƒë·ªô ph·∫£i l√† s·ªë t·ª´ 0-100</li>
                        <li>Bu·ªïi h·ªçc ph·∫£i l√† s·ªë nguy√™n d∆∞∆°ng</li>
                        <li>H·ªó tr·ª£ file .xlsx v√† .xls</li>
                    </ul>
                </div>
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-secondary" onclick="downloadTemplate()">üì• T·∫£i file m·∫´u</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="login-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('login-modal')">&times;</span>
            <h3>ƒêƒÉng nh·∫≠p admin</h3>
            <div class="form-container">
                <label>Email</label>
                <input type="email" id="login-email" class="form-input">
                <label>M·∫≠t kh·∫©u</label>
                <input type="password" id="login-password" class="form-input">
                <button class="btn" onclick="loginAdmin(event)">ƒêƒÉng nh·∫≠p</button>
            </div>
        </div>
    </div>
    <!-- Storage Status -->
    <div id="storage-status" class="storage-status">
        üíæ ƒê√£ l∆∞u
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script type="module" src="app.js"></script>
</body>

</html>